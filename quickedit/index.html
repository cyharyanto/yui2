<!DOCTYPE html public '-//w3c//dtd html 4.01//en' http://www.w3.org/tr/html4/strict.dtd'>
<html>
<head>
	<title>YUI 2 Quick Edit Example</title>
	<meta http-equiv=content-type content="text/html; charset=utf-8">

	<!-- Combo-handled YUI CSS files: -->
	<link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/combo?2.8.0r4/build/paginator/assets/skins/sam/paginator.css&2.8.0r4/build/datatable/assets/skins/sam/datatable.css">
	<!-- Combo-handled YUI JS files: -->
	<script type="text/javascript" src="http://yui.yahooapis.com/combo?2.8.0r4/build/yahoo-dom-event/yahoo-dom-event.js&2.8.0r4/build/element/element-min.js&2.8.0r4/build/paginator/paginator-min.js&2.8.0r4/build/datasource/datasource-min.js&2.8.0r4/build/datatable/datatable-min.js"></script>

	<script type="text/javascript">
	(function(){
		var orig = YAHOO.widget.DataTable._cloneObject;
		YAHOO.widget.DataTable._cloneObject = function(o)
		{
			if (o instanceof RegExp)
			{
				return o;
			}
			else
			{
				return orig(o);
			}
		}
	})();
	</script>
	<script type="text/javascript" src="QuickEdit.js"></script>

	<style type="text/css">
	#quick-edit-controls
	{
		display: none;
	}
	</style>
</head>
<body class="yui-skin-sam">

<script type="text/javascript">
YAHOO.util.Event.onDOMReady(function(){

	YAHOO.namespace('example');

	var Dom = YAHOO.util.Dom,
		Event = YAHOO.util.Event;

	YAHOO.example.Data = {
		bookorders: [
			{author:"C.S. Lewis", year:1950, quantity:10, title:"The Lion, the Witch and the Wardrobe"},
			{author:"C.S. Lewis", year:1951, quantity:5, title:"Prince Caspian: The Return to Narnia"},
			{author:"C.S. Lewis", year:1952, quantity:2, title:"The Voyage of the Dawn Treader"},
			{author:"C.S. Lewis", year:1953, quantity:6, title:"The Silver Chair"},
			{author:"C.S. Lewis", year:1954, quantity:9, title:"The Horse and His Boy"},
			{author:"C.S. Lewis", year:1955, quantity:4, title:"The Magician's Nephew"},
			{author:"C.S. Lewis", year:1956, quantity:8, title:"The Last Battle"},
			{author:"C.S. Lewis", year:1938, quantity:10, title:"Out of the Silent Planet"},
			{author:"C.S. Lewis", year:1943, quantity:5, title:"Perelandra"},
			{author:"C.S. Lewis", year:1945, quantity:2, title:"That Hideous Strength"},
			{author:"Philip Pullman", year:1995, quantity:7, title:"Northern Lights"},
			{author:"Philip Pullman", year:1997, quantity:5, title:"The Subtle Knife"},
			{author:"Philip Pullman", year:2000, quantity:8, title:"The Amber Spyglass"},
			{author:"J. R. R. Tolkien", year:1937, quantity:5, title:"The Hobbit"},
			{author:"J. R. R. Tolkien", year:1955, quantity:12, title:"The Fellowship of the Ring"},
			{author:"J. R. R. Tolkien", year:1955, quantity:0, title:"The Two Towers"},
			{author:"J. R. R. Tolkien", year:1955, quantity:8, title:"The Return of the King"},
			{author:"Philip K. Dick", year:1966, quantity:5, title:"Do Androids Dream of Electric Sheep?"},
			{author:"Robert A. Heinlein", year:1959, quantity:4, title:"Starship Troopers"},
			{author:"Robert A. Heinlein", year:1961, quantity:7, title:"Stranger in a Strange Land"},
			{author:"Robert A. Heinlein", year:1966, quantity:3, title:"The Moon Is a Harsh Mistress"},
			{author:"A. E. van Vogt", year:1946, quantity:3, title:"Slan"},
			{author:"A. E. van Vogt", year:1950, quantity:5, title:"The Voyage of the Space Beagle"},
			{author:"A. E. van Vogt", year:1970, quantity:8, title:"Quest for the Future"}
		]
	};

	YAHOO.example.quickEditDataTable = new YAHOO.widget.QuickEditDataTable(

		//Root element id
		"table", 

		//Column configuration
		[
			{
				key:"title",
				label:"Title",
				resizeable: true,
				sortable: true
			},
			{
				key:"author",
				label:"Author",
				resizeable: true,
				sortable: true,
				quickEdit: {
					validation: {
						fn: function(e) {
							if (e.value == "John Lindal") {
								this.displayMessage(e, 'He has never been published!', 'error');
								return false;
							}
							else {
								return true;
							}
						}
					}
				}
			},
			{
				key:"year",
				label:"Publication Date",
				resizeable: true,
				sortable: true,
				quickEdit: {
					validation: {
						regex: /^[0-9]{4}$/,
						msg: {
							regex: 'Please enter a four digit year.'
						}
					}
				}
			},
			{
				key:"quantity",
				label:"Quantity",
				resizeable: true,
				sortable: true,
				quickEdit: {
					copyDown: true,
					validation: {
//                          css: "yiv-integer:[0,]"
						regex: /^[0-9]+$/,
						msg: {
							regex: 'Please enter a positive integer.'
						}
					}
				}
			},
		],

		//Data Source 
		new YAHOO.util.DataSource(
			YAHOO.example.Data.bookorders,
			{
				responseType: YAHOO.util.DataSource.TYPE_JSARRAY,
				responseSchema:
				{
					fields: [ 'author', 'year', 'quantity', 'title' ]
				}
			}
		),

		//Attribute Config
		{
			paginator: new YAHOO.widget.Paginator({
				rowsPerPage:5,
				containers:'table-pagination'
			})
		}
	);

	/**
	* Quick Edit controls
	**/
	Event.on('start-quick-edit', 'click', function()
	{
		document.getElementById('start-quick-edit').disabled = true;
		Dom.setStyle('quick-edit-controls', 'display', 'inline');
		YAHOO.example.quickEditDataTable.startQuickEdit();
	});

	Event.on('save-quick-edit', 'click', function()
	{
		stopQuickEdit(true);
	});

	Event.on('cancel-quick-edit', 'click', function()
	{
		stopQuickEdit(false);
	});

	function stopQuickEdit(save)
	{
		if (save)
		{
			var changes = YAHOO.example.quickEditDataTable.getQuickEditChanges();
			if (changes === false)
			{
				return false;
			}

			var offset = YAHOO.example.quickEditDataTable.get('paginator').getStartIndex();
			for (var i=0; i<changes.length; i++)
			{
				var j = i + offset;
				for (var key in changes[i])
				{
					if (YAHOO.lang.hasOwnProperty(changes[i], key))
					{
						YAHOO.example.quickEditDataTable.getRecord(j).setData(key, changes[i][key]);
					}
				}
			}
		}

		document.getElementById('start-quick-edit').disabled = false;
		Dom.setStyle('quick-edit-controls', 'display', 'none');
		YAHOO.example.quickEditDataTable.cancelQuickEdit();
		return true;
	}
});
</script>


<h1>YUI 2 Quick Edit Example</h1>

<p>This is a demonstration of switching DataTable into <q>Quick Edit</q> mode. When the table first loads, it displays the normal way. When it switches to Quick Edit mode, the editable colums are filled with input fields.  <code>getQuickEditChanges()</code> returns the changed values for efficiently saving the updates.</p>

<p>In Quick Edit mode, hold down the Control key and press the up or down arrow keys to move within a column.</p>

<p>To test validation, try entering <q>John Lindal</q> as the author, anything other than 4 digits for the date, and anything other than a positive integer for the quantity.</p>

<div>
    <button id="start-quick-edit">Quick Edit</button>
    <span id="quick-edit-controls">
        <button id="save-quick-edit">Save</button>
        <button id="cancel-quick-edit">Cancel</button>
    </span>
</div>
<div id="table"></div>
<div id="table-pagination"></div>

</body>
</html>
